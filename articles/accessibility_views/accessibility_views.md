> You can find this article also at [habr.ru](https://habr.com/ru/company/surfstudio/blog/678294/)

![Обложка](https://github.com/weazyexe/activity/blob/master/articles/accessibility_views/assets/cover.jpeg)

# Accessibility в Android для чайников: адаптируем приложение для незрячих

В один из зимних вечеров я сидел дома, читал замечательную книжку «Android-программирование для профессионалов» и наткнулся на главу про Accessibility.

Раньше я об этой теме не задумывался: клал `null` в поле `contentDescription` и жил себе спокойно. Но когда получил поверхностные знания, как слабовидящие люди пользуются смартфоном через утилиту TalkBack, у меня появилось желание погрузиться в тему доступности глубже.

Меня зовут Тимур Задворнов, я Android-разработчик в Surf. Расскажу и покажу, как работает Accessibility в Android. Посмотрим, легко ли адаптировать приложения для людей с ограниченными возможностями — или это слишком трудоёмкая задача, к которой даже не стоит подступаться.

![Content Description meme](https://github.com/weazyexe/activity/blob/master/articles/accessibility_views/assets/contentdescription_meme.png)

Погружаться в тему Accessibility я начал с гуглежа статистики. [По данным ВОЗ](https://www.who.int/news-room/fact-sheets/detail/disability-and-health), в мире более миллиарда человек обладает с той или иной формой инвалидности. «Немало», — подумал я и сразу задался другим вопросом: а почему, если в мире так много людей с инвалидностью, огромное количество популярных и не очень приложений не поддерживают приложения для слабовидящих, глухих, людей с заболеваниями опорно-двигательного аппарата? Решил, что надо исправлять это недоразумение и двигать Accessibility в массы. 

## Для начала разберемся, что вообще такое Accessibility

![Да кто такой этот ваш Accessibility](https://github.com/weazyexe/activity/blob/master/articles/accessibility_views/assets/accessibility_who.png)

Accessibility в переводе с английского — «доступность». В контексте программного обеспечения — разработка ПО таким образом, чтобы им могли пользоваться люди с ограниченными возможностями. У термина есть общепринятое сокращение — *a11y*: между *a* и *y* в слове *accessibility* 11 букв.

Чтобы разобраться, как работает Accessibility, предлагаю задаться вопросом: а как в целом люди пользуются смартфоном? Пользователь взаимодействует с устройством, передавая ему действия: нажатия, свайпы, потряхивания. Смартфон возвращает результат действия, отображая его на экране. 

Мы взаимодействуем со смартфоном как привыкли: нажимаем на экран и получаем результат действия. Люди с ограниченными возможностями пользуются смартфоном точно так же, просто они передают и получают информацию со смартфона другими путями: отправляют голосовые команды, команды с другого устройства ввода. Способов много — подход общий.

![Пользователь передает действия, получает информацию](https://github.com/weazyexe/activity/blob/master/articles/accessibility_views/assets/phone_usage_graph.png)
<p align="center">Получаем данные, отправляем действия, чтобы получить новые данные</p>

В Android существуют встроенные Accessibility Services: TalkBack, Switch Access, Voice Access и прочие. О них можно думать как о плагинах для Android, которые помогают людям с ограниченными возможностями пользоваться смартфоном.

> Под термином «Accessibility Services» будут подразумеваться перечисленные сервисы, а не Android-сервисы для работы в бэкграунде. Пишу об этом, потому что в Android есть одноименный сервис — AccessibilityService, который работает в бэкграунде с отправляемыми ему AccessibilityEvent.

## Какие Accessibility Services существуют

С каждой новой версией Android выкатывает всё больше новых сервисов для пользователей с ограниченными возможностями. Сейчас в Android есть:

* TalkBack — зачитывает информацию о UI-компонентах;
* Switch Access — управление устройством через специальный контроллер;
* Voice Access — голосовое управление смартфоном;
* Select to Speak — зачитывает текстовый контент в выделенной области;
* Extra Dim — настройки яркости дисплея;
* Magnification — экранная лупа;
* Live Captions — экранные субтитры;
* Live Transcribe — перевод речи в текст;
* Sound Amplifier — управление звуком;
* Lookout — распознавание объектов через камеру;
* Action Blocks — создание сценариев использования.

И это ещё, возможно, не всё! 

Остановимся подробнее на первых трёх сервисах: TalkBack, Switch Access, Voice Access. Их используют чаще всего: именно с ними придётся сталкиваться разработчику в повседневной работе. Остальные — вспомогательные. Более подробно про них можно посмотреть в [официальной документации](https://www.android.com/accessibility/).

### TalkBack

TalkBack — утилита, которая зачитывает информацию с экрана. Помогает слабовидящим людям пользоваться смартфоном. 

TalkBack меняет логику управления смартфоном: пользователь выделяет нужный компонент, и система зачитывает содержимое. Компоненты экрана можно выделять либо тапом, свайпами влево и вправо или зажать палец на экране и двигать его — тогда TalkBack будет зачитывать каждый элемент, на который наведён жест. Свайп вправо — выделится следующий элемент на экране, свайп влево — предыдущий. 

Все привычные обычному пользователю жесты — назад, свернуть, меню многозадачности — работают, но их нужно воспроизводить двумя пальцами. Все действия и жесты TalkBack описаны в [документации](https://support.google.com/accessibility/android/answer/6151827).

На каждом смартфоне с Android на борту можно включить TalkBack и пройти туториал по использованию: всё это делается в настройках, пункт Accessibility. 

https://user-images.githubusercontent.com/35996778/180798035-b48b74fc-10cc-4fe1-902a-4d1c2ed4f230.mp4

> В настройках TalkBack есть меню с настройками для разработчиков. Можно включить субтитры или добавить шорткат быстрого включения и выключения TalkBack — зажать кнопки громкости на несколько секунд. Очень помогает во время разработки.

### Switch Access

Switch Access — сервис для управления смартфоном с помощью специального устройства, переключателя. 

![Так может выглядеть переключатель](https://github.com/weazyexe/activity/blob/master/articles/accessibility_views/assets/switch.png)
<p align="center">Так может выглядеть переключатель</p>

Принцип взаимодействия со смартфоном схож с принципом работы через TalkBack. На экране выделен компонент, между компонентами можно переключаться. Обычно на переключателе есть несколько кнопок. В качестве переключателя можно использовать специальное устройство или настроить  стороннюю клавиатуру, а также кнопки громкости на смартфоне для удобного дебаггинга.

### Voice Access

Voice Access — сервис для голосового управления смартфоном. Пользователь говорит, какое действие нужно сделать на экране: нажать кнопку «Лайк», пролистать вниз, ввести текст в поле «Сообщение». Действие выполняется. На видео — Voice Access в действии.

https://user-images.githubusercontent.com/35996778/180798614-15a3d16b-5d6b-4036-9377-7201f80b1ba8.mp4

На самом деле Voice Access далеко не идеальная вещь: иногда тупит и некорректно распознаёт слова — особенно названия приложений.

## Что происходит со стороны разработчиков

Давайте посмотрим, какие инструменты есть для разработчиков, чтобы UX приложений не страдал. Хорошие новости: все компоненты из стандартной библиотеки Android по умолчанию поддерживают Accessibility. Не придётся с нуля разбираться и делать доступными базовые компоненты: TextView, EditText, Switch и другие.

### Приложение Accessibility Scanner для помощи разработчикам

Google выпустил для разработчиков приложение *Accessibility Scanner*: оно помогает найти некомфортные для людей с ограниченными возможностями места в приложении. 

Live Region
https://user-images.githubusercontent.com/35996778/180798854-2a5ed1e0-0225-4d4b-be63-a219a4cd803c.mp4

Switch Accessible
https://user-images.githubusercontent.com/35996778/180798906-795960d0-f13b-4e78-ba1e-b0ec5288352f.mp4

Wallet Accessible
https://user-images.githubusercontent.com/35996778/180798985-d9453539-33e1-4528-b45b-50dc8e4d1512.mp4
